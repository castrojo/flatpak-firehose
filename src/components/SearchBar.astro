---
// SearchBar component for app name search
// Shows matching apps, clicking an app scrolls to it

interface Props {
  apps: string[];
}

const { apps } = Astro.props;
---

<div class="search-container" data-all-apps={JSON.stringify(apps)}>
  <div class="search-wrapper">
    <input
      type="search"
      id="search-input"
      class="search-input"
      placeholder="Use / to search for apps"
      aria-label="Search apps"
      autocomplete="off"
    />
    <button
      type="button"
      id="search-clear"
      class="search-clear"
      aria-label="Clear search"
      style="display: none;"
    >
      âœ•
    </button>
  </div>
  
  <div id="search-results" class="search-results" style="display: none;">
    <div class="search-results-header">
      <span id="search-count"></span>
    </div>
    <div id="search-results-list" class="search-results-list"></div>
  </div>
</div>

<script>
  import { initSearch } from '../scripts/search';
  
  // Initialize search on DOM ready
  document.addEventListener('DOMContentLoaded', () => {
    const searchContainer = document.querySelector('.search-container') as HTMLElement;
    const allAppsData = searchContainer?.dataset.allApps;
    
    if (allAppsData) {
      try {
        const apps = JSON.parse(allAppsData);
        initSearch(searchContainer, apps);
      } catch (e) {
        console.error('[SearchBar] Failed to parse apps data:', e);
      }
    } else {
      console.error('[SearchBar] No apps data found');
    }
  });
</script>

<style>
  .search-container {
    position: relative;
  }
  
  .search-wrapper {
    position: relative;
    width: 100%;
  }
  
  .search-input {
    width: 100%;
    padding: 0.75rem 2.5rem 0.75rem 1rem;
    font-size: 1rem;
    border: 1px solid var(--color-border-default, #d0d7de);
    border-radius: 6px;
    background: var(--color-bg-default, #ffffff);
    color: var(--color-text-primary, #24292f);
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  
  .search-input:focus {
    outline: none;
    border-color: var(--color-accent-emphasis, #6c7ae9);
    box-shadow: 0 0 0 3px rgba(108, 122, 233, 0.1);
  }
  
  .search-input::placeholder {
    color: var(--color-text-tertiary, #6e7781);
  }
  
  .search-clear {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: var(--color-text-secondary, #57606a);
    font-size: 1.25rem;
    width: 2rem;
    height: 2rem;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }
  
  .search-clear:hover {
    background: var(--color-bg-secondary, #f6f8fa);
  }
  
  .search-results {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    right: 0;
    width: 100%;
    background: var(--color-bg-default, #ffffff);
    border: 1px solid var(--color-border-default, #d0d7de);
    border-radius: 6px;
    box-shadow: 0 8px 24px rgba(140, 149, 159, 0.2);
    max-height: 600px;
    overflow: hidden;
    z-index: 1000;
  }
  
  .search-results-header {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--color-border-default, #d0d7de);
    font-size: 0.875rem;
    color: var(--color-text-secondary, #57606a);
    font-weight: 600;
  }
  
  .search-results-list {
    max-height: 540px;
    overflow-y: auto;
  }
  
  .search-result {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--color-border-default, #d0d7de);
    cursor: pointer;
    transition: background 0.2s;
  }
  
  .search-result:last-child {
    border-bottom: none;
  }
  
  .search-result:hover {
    background: var(--color-bg-secondary, #f6f8fa);
  }
  
  .app-name {
    font-weight: 500;
    color: var(--color-text-primary, #24292f);
    font-size: 0.9375rem;
  }
  
  .search-result:hover .app-name {
    color: var(--color-text-link, #6c7ae9);
  }
  
  .no-results {
    padding: 2rem;
    text-align: center;
    color: var(--color-text-secondary, #57606a);
  }
  
  .no-results p:first-child {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
  
  .no-results-hint {
    font-size: 0.875rem;
    color: var(--color-text-tertiary, #6e7781);
  }
  
  /* Mobile responsive */
  @media (max-width: 768px) {
    .search-wrapper {
      max-width: 100%;
    }
    
    .search-results {
      max-width: 100%;
      max-height: 400px;
    }
    
    .search-results-list {
      max-height: 340px;
    }
    
    .search-input {
      font-size: 0.9375rem;
    }
  }
  
  @media (max-width: 480px) {
    .search-input {
      padding: 0.625rem 2rem 0.625rem 0.75rem;
      font-size: 0.875rem;
    }
    
    .search-result {
      padding: 0.75rem;
    }
  }
</style>
