# Bluefin Releases

A release tracker for Bluefin-specific Flatpak apps and Homebrew packages with changelogs from source repositories.

## Overview

This project tracks Flatpak applications and Homebrew packages specific to the Bluefin project and displays their changelogs from the actual source repositories. It follows the architecture pattern of [castrojo/firehose](https://github.com/castrojo/firehose) with a Go backend and Astro frontend.

## Architecture

**Hybrid Approach:** Go backend (data pipeline) + Astro frontend (UI rendering)

### What Go Does
- Fetches recently updated apps from Flathub API (`/api/v2/feed/recently-updated`)
- Fetches detailed app metadata including appstream releases
- Identifies source GitHub repositories for each app from metadata
- Fetches actual release notes from GitHub repositories
- Outputs JSON data (`src/data/apps.json`) for Astro to consume

### What Astro Does
- Imports JSON data (generated by Go)
- Renders static HTML with responsive app cards
- Displays changelogs from both Flathub metadata and GitHub releases (prioritizing GitHub)
- Deploys to GitHub Pages

## Project Structure

```
bluefin-releases/
├── cmd/
│   └── bluefin-releases/
│       └── main.go              # CLI entry point
├── internal/
│   ├── models/
│   │   └── models.go            # Data structures
│   ├── flathub/
│   │   └── flathub.go           # Flathub API integration
│   └── github/
│       └── github.go            # GitHub API integration
├── src/
│   ├── pages/
│   │   └── index.astro          # Main page
│   ├── components/
│   │   └── AppCard.astro        # App card component
│   └── data/
│       └── apps.json            # Generated by Go (gitignored)
├── .github/
│   └── workflows/
│       └── deploy.yml           # GitHub Actions workflow
├── go.mod                       # Go module definition
├── package.json                 # Node dependencies
├── astro.config.mjs             # Astro configuration
└── README.md                    # This file
```

## Building

### Prerequisites

- Go 1.21 or later
- Node.js 20 or later
- (Optional) `GITHUB_TOKEN` environment variable for GitHub API access

### Local Development

```bash
# Install Go dependencies
go mod download

# Install Node dependencies
npm install

# Build (runs Go pipeline, then Astro build)
npm run build

# Preview the built site
npm run preview

# Development server (requires pre-generated data)
npm run dev
```

### Running the Go Pipeline Manually

```bash
# Run without GitHub integration (uses only Flathub metadata)
go run cmd/bluefin-releases/main.go

# Run with GitHub integration (fetches actual release notes)
GITHUB_TOKEN=your_token_here go run cmd/bluefin-releases/main.go
```

## Data Flow

1. **Fetch Flathub Apps** → Get recently updated apps from Flathub API
2. **Enrich with Details** → Fetch app metadata, extract source repo URLs
3. **Fetch GitHub Releases** → Get actual changelogs from source repositories (if `GITHUB_TOKEN` is set)
4. **Output JSON** → Write to `src/data/apps.json`
5. **Astro Build** → Generate static site from JSON data

## Deployment

### GitHub Actions

The repository includes a GitHub Actions workflow (`.github/workflows/deploy.yml`) that:

1. Runs daily at 6 AM UTC to catch new Flathub updates
2. Can be manually triggered
3. Executes the Go pipeline with GitHub API access
4. Builds the Astro site
5. Deploys to GitHub Pages

### Setup GitHub Pages

1. Go to repository Settings → Pages
2. Set Source to "GitHub Actions"
3. The workflow will automatically deploy on push to main or on schedule

### Environment Variables

- `GITHUB_TOKEN`: Automatically provided by GitHub Actions for API access
- No additional secrets needed

## Features

- ✅ Tracks recently updated Flathub applications
- ✅ Shows changelogs from actual source repositories (not @flathub packaging repos)
- ✅ Maps apps to their GitHub repositories automatically
- ✅ Fetches GitHub release notes for real changelogs
- ✅ Falls back to Flathub appstream releases when GitHub is unavailable
- ✅ Dark theme UI inspired by GitHub Primer
- ✅ Responsive grid layout
- ✅ Collapsible changelog sections
- ✅ Parallel data fetching with goroutines
- ✅ Rate limiting for API calls
- ✅ Detailed build statistics and performance metrics

## Key Differences from @flathub Changelogs

This project fetches changelogs from the **actual application source repositories**, not the Flathub packaging repositories. For example:

- **Flathub repo**: `github.com/flathub/org.gimp.GIMP` (packaging metadata)
- **Actual source**: `github.com/GNOME/gimp` (real release notes)

The Go pipeline automatically:
1. Extracts the source repo URL from Flathub app metadata
2. Identifies if it's a GitHub repository
3. Fetches the latest releases from the source repo
4. Displays those changelogs alongside Flathub metadata

## Performance

- **Flathub fetch**: ~1-2s for recently updated apps list
- **Details enrichment**: ~5-10s for 50 apps (parallel with rate limiting)
- **GitHub enrichment**: ~10-20s for apps with GitHub repos (with rate limiting)
- **Total pipeline**: ~15-30s depending on number of apps and network conditions
- **Astro build**: ~1-2s

## License

MIT